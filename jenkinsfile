pipeline {
    agent any

    environment {
        SONARQUBE_SERVER = 'SonarQube'
        SONARQUBE_URL = 'http://3.86.93.46:9000'
        NEXUS_URL = 'http://54.242.72.14:8081' // âœ… Updated Nexus IP
        NEXUS_CREDENTIALS_ID = 'nexus-creds'
        SLACK_CHANNEL = '#your-channel'
        SLACK_CREDENTIALS_ID = 'slack-token'
        TOMCAT_URL = 'http://3.86.140.185:8080/manager/text'
        TOMCAT_CREDENTIALS_ID = 'tomcat-creds'
        MAVEN_SETTINGS_FILE_ID = 'my-maven-settings'
    }

    stages {
        stage('Git Clone') {
            steps {
                git url: 'https://github.com/manikiran7/jenkins.git', branch: 'main'
            }
        }

        stage('SonarQube Analysis') {
            steps {
                script {
                    def mvnHome = tool 'MVN_HOME'
                    withSonarQubeEnv("${SONARQUBE_SERVER}") {
                        configFileProvider([configFile(fileId: "${MAVEN_SETTINGS_FILE_ID}", variable: 'MAVEN_SETTINGS')]) {
                            sh "${mvnHome}/bin/mvn -s $MAVEN_SETTINGS clean verify sonar:sonar"
                        }
                    }
                }
            }
        }

        stage('Maven Compile') {
            steps {
                script {
                    def mvnHome = tool 'MVN_HOME'
                    configFileProvider([configFile(fileId: "${MAVEN_SETTINGS_FILE_ID}", variable: 'MAVEN_SETTINGS')]) {
                        sh "${mvnHome}/bin/mvn -s $MAVEN_SETTINGS clean package"
                    }
                }
            }
        }

        stage('Nexus Upload') {
            steps {
                script {
                    def mvnHome = tool 'MVN_HOME'
                    withCredentials([usernamePassword(
                        credentialsId: "${NEXUS_CREDENTIALS_ID}",
                        usernameVariable: 'NEXUS_USER',
                        passwordVariable: 'NEXUS_PASS'
                    )]) {
                        configFileProvider([configFile(fileId: "${MAVEN_SETTINGS_FILE_ID}", variable: 'MAVEN_SETTINGS')]) {
                            sh """
                                ${mvnHome}/bin/mvn -s $MAVEN_SETTINGS deploy \
                                -Dnexus.username=$NEXUS_USER \
                                -Dnexus.password=$NEXUS_PASS
                            """
                        }
                    }
                }
            }
        }

        stage('Slack Notification') {
